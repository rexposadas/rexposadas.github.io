<!DOCTYPE html>
<html>
  <head>
    <title>Intro to Python&#39;s Beaver</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>
<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link rel="stylesheet" href="/google-fonts/Mulish/mulish.css"/>


<link rel="stylesheet" href="/fontawesome/css/all.min.css"/>







<meta property="og:title" content="Intro to Python&#39;s Beaver" />
<meta property="og:description" content="Working with Python&#39;s Beaver" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rexposadas.github.io/posts/beaver/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-08T06:00:23+06:00" />
<meta property="article:modified_time" content="2021-06-08T06:00:23+06:00" />



    
    
<meta name="description" content="Working with Python&#39;s Beaver" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>



    




</head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    












<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      Software Development by Rex Posadas</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      
      </ul>
    </div>
  </div>
  
  
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/generated/generated_code/" title="Generated Art">Generated Art</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/binarytree/" title="BinaryTree">BinaryTree</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/i_got_this/" title="I got this! No, I don&#39;t">I got this! No, I don&#39;t</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/beaver/" title="Beaver">Beaver</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/beaver-to-nsq/" title="Beaver to NSQ">Beaver to NSQ</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/images/circle.png);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/rex_hu47fe1cd19085881e79115df9d8bc46ad_295531_120x120_fit_box_3.png' alt="Author Image">
          <h5 class="author-name">Rex Posadas</h5>
          <p>Tuesday, June 8, 2021</p>
        </div>

        <div class="title">
          <h1>Intro to Python&#39;s Beaver</h1>
        </div>
        
        <div class="post-content" id="post-content">
          <h1 id="leave-it-the-logging-to-beaver">Leave it (the logging) to Beaver</h1>
<p>This post shows you how to get started with <a href="https://github.com/josegonzalez/beaver">beaver</a>.</p>
<p>Follow the installation instructions in the Github page.</p>
<h1 id="the-setup">The Setup</h1>
<p>Run the following in order to determine if you have beaver up.</p>
<pre><code>beaver -h
</code></pre>
<p>That should give you the manual.</p>
<p>What we are going to do is simple.  Have beaver listen to a file and then output to stdout. It&rsquo;s a simple simulation of beaver listening to a log file and processing it&rsquo;s updates.</p>
<p>Create a file that will serve as your log file. This is what beaver will listen to.</p>
<pre><code>touch in.log
</code></pre>
<p>Create a config file to tell beaver what version of logentries we would like.</p>
<pre><code>vim beaver.conf
</code></pre>
<p>In the conf file enter:</p>
<pre><code>[beaver]
logstash_version: 1
</code></pre>
<p>In one terminal start beaver, setting the config file and the file we would like to listen to. The command below should start a</p>
<pre><code>beaver -c beaver.conf -f in.log
</code></pre>
<p>In another terminal add content to in.log</p>
<pre><code>echo &quot;hello&quot; &gt;&gt; in.log
</code></pre>
<p>You should see something like this in the terminal you ran beaver in.</p>
<pre><code>{
&quot;tags&quot;: [],
&quot;@version&quot;: 1,
&quot;@timestamp&quot;: &quot;2014-06-19T15:22:38.907Z&quot;,
&quot;host&quot;: &quot;provisioner&quot;,
&quot;file&quot;: &quot;/home/rex/workspace/in.log&quot;,
&quot;message&quot;: &quot;hello&quot;,
&quot;type&quot;: &quot;file&quot;
}
</code></pre>
<p>Done!  Beaver is now working for you.</p>
<h1 id="issues">Issues</h1>
<p>Beaver depends on the python request module.  <a href="http://stackoverflow.com/questions/24314333/error-encountered-configuring-beaver-to-use-http-as-the-transport">Here is the issue and the solution</a>.</p>
<h1 id="nsq">NSQ</h1>
<p>NSQ will serve as our broker.  The broker serves a queue. It holds the messages in case (1) log consumers (in our case ELK) goes down (2) log consumers cannot process the logs fast enough.  Ideally, nsq will be empty most of the time.</p>
<h2 id="installation">Installation</h2>
<p>nsq is easy enough to <a href="http://nsq.io/overview/quick_start.html">install</a>.</p>
<p>The only different in our setup is that instead of nsq outputing to a file, we will output to http.  The http will point to elastic search.</p>
<h1 id="connecting-beaver-to-nsq">Connecting Beaver to NSQ</h1>
<p>Beaver has can transport logs via http. Create a beaver config file (beaver.conf).</p>
<pre><code>[beaver]                                                                     
logstash_version: 1
transport: http
http_url: http://127.0.0.1:4151/put?topic=test
 
[in.log]
</code></pre>
<p>This config file instructs beaver to POST it&rsquo;s output to http at the specified URL.  Change the host and port accordinly to point to your nsq instance.</p>
<p>Restart beaver passing the config file.</p>
<pre><code>beaver -c beaver.conf
</code></pre>
<p>Now add to the log you are listening in.</p>
<pre><code>echo &quot;nsq attached&quot; &gt;&gt; in.log
</code></pre>
<p>Take a look at your nsq admin page. Just as in the nsq installation page, the default URL is http://127.0.0.1:4171/.  You will see that the number of messages increased by 1.  This means that a log entry made it to nsq.  So the path of the log was:</p>
<pre><code>in.log -&gt; beaver -&gt; nsq
</code></pre>
<p>You now have beaver and nsq connected!</p>
<h1 id="the-elk-stack">The ELK stack</h1>
<p>The ELK stack will store and process our logs.</p>
<h2 id="elasticsearch">ElasticSearch</h2>
<p>Elastic search accepts HTTP requests as data input.</p>

        </div>

        
        <div class="row pl-3 pr-3">
        
        <div class="col-md-6 share-buttons">
        
          </div>

        
        
        </div>



      
      <hr />
        







  





  
  

  
  

  
  

  
    
    
  
  

  
  


<div class="row next-prev-navigator">
  
    <div class="col-md-6 previous-article">
      <a href="/posts/i_got_this/" title="I got this! No, I don&#39;t" class="btn btn-outline-info">
        <div><i class="fas fa-chevron-circle-left"></i> Prev</div>
        <div class="next-prev-text">I got this! No, I don&#39;t</div>
      </a>
    </div>
  
  
      
      
        
      
      <div class="col-md-6 next-article">
        <a href="/posts/beaver-to-nsq/" title="Beaver to NSQ" class="btn btn-outline-info">
          <div>Next <i class="fas fa-chevron-circle-right"></i></div>
          <div class="next-prev-text">Beaver to NSQ</div>
        </a>
      </div>
    
</div>

      <hr />

      
      

      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
  </section>

    </div>

    
    












  
  
    
  

  
  
    
  

  
  

  
  
    
    
      
    
  


  
  
  
    
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://rexposadas.github.io/#skills">Skills</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://rexposadas.github.io/#recent-posts">Recent Posts</a>
                </li>
              
            
              
            
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
              
                <li><a href=mailto:rexposadas@gmail.com target="_blank" rel="noopener">
                  <span><i class="fas fa-envelope"></i></span> <span>rexposadas@gmail.com</span>
                </a></li>
              
            
              
                <li><a href=https://github.com/rexposadas target="_blank" rel="noopener">
                  <span><i class="fab fa-github"></i></span> <span>rexposadas</span>
                </a></li>
              
            
              
                <li><a href=https://www.linkedin.com/in/rexposadas target="_blank" rel="noopener">
                  <span><i class="fab fa-linkedin"></i></span> <span>Rex Posadas</span>
                </a></li>
              
            
          </ul>
        </div>
        
        
        
          
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hossainemruz/toha" target="_blank" rel="noopener">
            <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">© 2022 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>



    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>









    
</body>
</html>
